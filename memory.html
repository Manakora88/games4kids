<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Memory</title>
        <link rel='stylesheet' href='css/style.css'>
        <link href="https://fonts.googleapis.com/css?family=Righteous&display=swap&subset=latin-ext" rel="stylesheet">
    </head>

    <body>
        <main class="game-memory">
            <section class="memo">
                <div class="memory-board">
                    <div id="card0" class="cards"></div>
                    <div id="card1" class="cards"></div>
                    <div id="card2" class="cards"></div>
                    <div id="card3" class="cards"></div>
                    <div id="card4" class="cards"></div>
                    <div id="card5" class="cards"></div>
                    <div id="card6" class="cards"></div>
                    <div id="card7" class="cards"></div>
                    <div id="card8" class="cards"></div>
                    <div id="card9" class="cards"></div>
                    <div id="card10" class="cards"></div>
                    <div id="card11" class="cards"></div>
                    <div id="card12" class="cards"></div>
                    <div id="card13" class="cards"></div>
                    <div id="card14" class="cards"></div>
                    <div id="card15" class="cards"></div>
                    <div id="card16" class="cards"></div>
                    <div id="card17" class="cards"></div>
                    <div id="card18" class="cards"></div>
                    <div id="card19" class="cards"></div>
                </div>
                <div class="memory-score">
                    <div id="score">
                        Liczba ruchów: 0
                    </div>
                </div>
                <a href="./memory.html">
                    <button class="new-game" onclick="mixArray(cards)" title="Wczytaj nową grę">
                        Nowa gra
                    </button>
                </a>
                <div class="freepik">
                    <a href="https://pl.freepik.com/darmowe-zdjecie-wektory/karykatura">
                        Grafiki wykorzystane w grze to plik wektorowy utworzony przez freepik - pl.freepik.com
                    </a>
                </div>
            </section>
            <a href="./index.html">
                <button class="back" title="Wróć do wyboru gier">
                    Wróć
                </button>
            </a>
        </main>

        <script>
            //tablica z nazwami grafik dla odkrytych kart
            var cardsList = ["bobr.png","zebra.png","pies.png","kaczka.png","mors.png","osiol.png","mors.png","krowa.png","slon.png","lew.png","kaczka.png","krowa.png","bobr.png","lew.png","pies.png","zebra.png","malpa.png","slon.png","osiol.png","malpa.png"];

            //zmienne "trzymające" poszczególne karty
            var card0 = document.getElementById("card0");
            var card1 = document.getElementById("card1");
            var card2 = document.getElementById("card2");
            var card3 = document.getElementById("card3");
            var card4 = document.getElementById("card4");
            var card5 = document.getElementById("card5");
            var card6 = document.getElementById("card6");
            var card7 = document.getElementById("card7");
            var card8 = document.getElementById("card8");
            var card9 = document.getElementById("card9");
            var card10 = document.getElementById("card10");
            var card11 = document.getElementById("card11");
            var card12 = document.getElementById("card12");
            var card13 = document.getElementById("card13");
            var card14 = document.getElementById("card14");
            var card15 = document.getElementById("card15");
            var card16 = document.getElementById("card16");
            var card17 = document.getElementById("card17");
            var card18 = document.getElementById("card18");
            var card19 = document.getElementById("card19");

            //pozostałe zmienne
            var stop = false; //zablokowanie odkrywania pozostalych kart do czasu, aż dwie wcześniej odkryte znów się zasłonią lub znikną, gdy tworzą one parę
            var visible1 = false; //gdy false to odsłaniamy pierwszą kartę, gdy true - pierwsza karta jest już widoczna i odsłaniamy drugą
            var visible1_index; //indeks odsłoniętej pierwszej karty
            var left = 10; //ile zostało par do znalezienia
            var counter = 0; //licznik wykonanych ruchów
            var cards = []; //tablica na przemieszane karty

            //funkcja do przemieszania kart
            function mixArray(cardsList) {
                for (var i = cardsList.length; i >= 0; i--) {
                    var f = Math.floor(Math.random()*(i+1));
                    for (var j = 0, k = 0; j < cardsList.length; j++) {
                        if (cards[j] === undefined) {
                            if (k === f) {
                                cards[j] = cardsList[i];
                                break;
                            }
                            k++;
                        }
                    }
                }
                return cards;
            }
            mixArray(cardsList);

            //funkcja do odkrywania kart
            function uncoverCard(number) {
                var cardd = document.getElementById("card"+number);
                var opac = window.getComputedStyle(cardd,null).getPropertyValue('opacity');
                if (opac != 0 && stop == false) { //jeśli karta nie zniknęła po sparowaniu (czyli jest widoczna) i nie ma blokady odkrywania karty (czyli jeszcze nie są odkryte dwie karty)
                    stop = true;
                    document.getElementById("card" + number).style.backgroundImage = "url(./img/memory/" + cards[number] + ")";

                    if (visible1 == false) { //karta jest odkryta jako pierwsza
                        visible1 = true;
                        visible1_index = number;
                        stop = false;
                    } else {
                        //odsłaniam drugą kartę
                        if (cards[visible1_index] == cards[number]) { //gdy odkryte karty tworzą parę
                            setTimeout(function() {
                                goodCards(number, visible1_index)
                            }, 1000);
                        } else { //gdy odkryte karty nie są parą
                            setTimeout(function() {
                                wrongCards(number, visible1_index)
                            }, 1000);
                        }
                        counter++;
                        document.getElementById("score").innerHTML = 'Liczba ruchów: ' + counter;
                        visible1 = false;
                    }
                }
            }

            //funkcja do znikania sparowanych kart
            function goodCards(numb1, numb2) {
                document.getElementById("card" + numb1).style.opacity = "0";
                document.getElementById("card" + numb2).style.opacity = "0";
                left--;
                if (left == 0) {
                    document.querySelector(".memory-board").innerHTML = "<p>Brawo! Udało Ci się ukończyć grę w <span>" + counter + "</span> ruchach</p>";
                    document.querySelector(".memory-score").style.visibility = "hidden";
                }
                stop = false;
            }

            //funkcja do ponownego zakrycia niedobranych kart
            function wrongCards(numb1, numb2) {
                document.getElementById("card" + numb1).style.backgroundImage = "url(./img/memory/karta.png)";
                document.getElementById("card" + numb1).classList.remove("activeCard");
                document.getElementById("card" + numb2).style.backgroundImage = "url(./img/memory/karta.png)";
                document.getElementById("card" + numb2).classList.remove("activeCard");
                stop = false;
            }

            //zdarzenia do klikanej karty
            card0.addEventListener("click", function() {
                uncoverCard(0);
                this.classList.add("activeCard");
            });
            card1.addEventListener("click", function() {
                uncoverCard(1);
                this.classList.add("activeCard");
            });
            card2.addEventListener("click", function() {
                uncoverCard(2);
                this.classList.add("activeCard");
            });
            card3.addEventListener("click", function() {
                uncoverCard(3);
                this.classList.add("activeCard");
            });
            card4.addEventListener("click", function() {
                uncoverCard(4);
                this.classList.add("activeCard");
            });
            card5.addEventListener("click", function() {
                uncoverCard(5);
                this.classList.add("activeCard");
            });
            card6.addEventListener("click", function() {
                uncoverCard(6);
                this.classList.add("activeCard");
            });
            card7.addEventListener("click", function() {
                uncoverCard(7);
                this.classList.add("activeCard");
            });
            card8.addEventListener("click", function() {
                uncoverCard(8);
                this.classList.add("activeCard");
            });
            card9.addEventListener("click", function() {
                uncoverCard(9);
                this.classList.add("activeCard");
            });
            card10.addEventListener("click", function() {
                uncoverCard(10);
                this.classList.add("activeCard");
            });
            card11.addEventListener("click", function() {
                uncoverCard(11);
                this.classList.add("activeCard");
            });
            card12.addEventListener("click", function() {
                uncoverCard(12);
                this.classList.add("activeCard");
            });
            card13.addEventListener("click", function() {
                uncoverCard(13);
                this.classList.add("activeCard");
            });
            card14.addEventListener("click", function() {
                uncoverCard(14);
                this.classList.add("activeCard");
            });
            card15.addEventListener("click", function() {
                uncoverCard(15);
                this.classList.add("activeCard");
            });
            card16.addEventListener("click", function() {
                uncoverCard(16);
                this.classList.add("activeCard");
            });
            card17.addEventListener("click", function() {
                uncoverCard(17);
                this.classList.add("activeCard");
            });
            card18.addEventListener("click", function() {
                uncoverCard(18);
                this.classList.add("activeCard");
            });
            card19.addEventListener("click", function() {
                uncoverCard(19);
                this.classList.add("activeCard");
            });

            //wgranie nowej gry
            var btn = document.querySelector(".new-game");
            btn.addEventListener("click", function(cards,i) {
                for (i = cards.length; i; cards.push(cards.splice(~~(Math.random()*(i--)),1)));
            })
        </script>
    </body>

</html>
